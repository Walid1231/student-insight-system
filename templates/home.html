<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #f4f6f9;
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .progress {
            height: 20px;
        }
    </style>
</head>
<body>

<div class="container mt-4">

    <!-- Header -->
    <div class="mb-4">
        <h2>Welcome, {{ student.full_name }}</h2>
        <p>Department: {{ student.department }}</p>
        <p>Current CGPA: <strong>{{ student.current_cgpa }}</strong></p>
    </div>

    <!-- Row 1 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card p-3">
                <h5>CGPA & SGPA Trend</h5>
                <canvas id="gpaChart"></canvas>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card p-3">
                <h5>Core vs GED Performance</h5>
                <canvas id="coreGedChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Row 2 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card p-3">
                <h5>Weekly Study Hours</h5>
                <canvas id="weeklyChart"></canvas>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card p-3">
                <h5>Skill Effort Distribution</h5>
                <canvas id="skillChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Row 3 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card p-3">
                <h5>Career Compatibility</h5>
                <canvas id="careerChart"></canvas>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card p-3">
                <h5>Strength & Weakness</h5>

                <p><strong>Strong Subjects:</strong></p>
                <ul>
                    {% for sub in strong_subjects %}
                        <li>{{ sub }}</li>
                    {% else %}
                        <li>No strong subjects detected</li>
                    {% endfor %}
                </ul>

                <p><strong>Weak Subjects:</strong></p>
                <ul>
                    {% for sub in weak_subjects %}
                        <li>{{ sub }}</li>
                    {% else %}
                        <li>No weak subjects detected</li>
                    {% endfor %}
                </ul>

            </div>
        </div>
    </div>

    <!-- Row 4 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card p-3">
                <h5>Burnout Risk</h5>
                <div class="progress">
                    <div class="progress-bar bg-danger"
                         role="progressbar"
                         style="width: {{ burnout_risk }}%">
                        {{ burnout_risk }}%
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card p-3">
                <h5>Goal Achievability Probability</h5>
                <div class="progress">
                    <div class="progress-bar bg-success"
                         role="progressbar"
                         style="width: {{ goal_probability }}%">
                        {{ goal_probability }}%
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ============================= -->
<!-- Chart Scripts -->
<!-- ============================= -->

<script>
/* 1️⃣ GPA Trend */
let gpaData = {{ gpa_trend|safe }};
new Chart(document.getElementById('gpaChart'), {
    type: 'line',
    data: {
        labels: gpaData.map((_, i) => "Sem " + (i+1)),
        datasets: [{
            label: 'SGPA',
            data: gpaData,
            borderWidth: 2
        }]
    }
});

/* 2️⃣ Core vs GED */
new Chart(document.getElementById('coreGedChart'), {
    type: 'pie',
    data: {
        labels: ['Core', 'GED'],
        datasets: [{
            data: [{{ avg_core }}, {{ avg_ged }}]
        }]
    }
});

/* 3️⃣ Weekly Study Hours */
let weeklyData = {{ weekly_hours|tojson }};
new Chart(document.getElementById('weeklyChart'), {
    type: 'bar',
    data: {
        labels: Object.keys(weeklyData),
        datasets: [{
            label: "Hours",
            data: Object.values(weeklyData)
        }]
    }
});

/* 4️⃣ Skill Effort */
let skillData = {{ skill_hours|tojson }};
new Chart(document.getElementById('skillChart'), {
    type: 'bar',
    data: {
        labels: Object.keys(skillData),
        datasets: [{
            label: "Hours",
            data: Object.values(skillData)
        }]
    }
});

/* 5️⃣ Career Compatibility */
let careers = {{ career_scores|tojson }};
new Chart(document.getElementById('careerChart'), {
    type: 'bar',
    data: {
        labels: careers.map(c => c.career),
        datasets: [{
            label: "Compatibility %",
            data: careers.map(c => c.score)
        }]
    }
});
</script>

</body>
</html>
